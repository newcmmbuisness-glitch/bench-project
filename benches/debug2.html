<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bench Images Debug</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .debug-section h3 { margin-top: 0; }
        .test-button { background: #4caf50; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .test-button:hover { background: #45a049; }
        .result { margin: 10px 0; padding: 10px; background: #f9f9f9; border-radius: 3px; }
        .error { background: #fee; color: #c33; }
        .success { background: #efe; color: #363; }
        .image-test { display: flex; gap: 10px; align-items: center; margin: 5px 0; }
        .result-image { max-width: 100px; height: 60px; object-fit: cover; border: 2px solid #ddd; border-radius: 3px; }
        .error-border { border-color: #c33; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 3px; overflow-x: auto; font-size: 12px; }
    </style>
</head>
<body>
    <h1>üîß Bench Images Debug Tool</h1>
    
    <div class="debug-section">
        <h3>1. Test Netlify Function</h3>
        <input type="number" id="benchId" placeholder="Bench ID (z.B. 1)" value="1">
        <button class="test-button" onclick="testNetlifyFunction()">Test Function Call</button>
        <div id="netlifyResult" class="result" style="display:none;"></div>
    </div>

    <div class="debug-section">
        <h3>2. Test Original vs Additional Images</h3>
        <button class="test-button" onclick="testImageLoading()">Test Image Loading</button>
        <div id="imageTestResult"></div>
    </div>

    <div class="debug-section">
        <h3>3. Database Status Check</h3>
        <button class="test-button" onclick="checkDatabaseStatus()">Check Database</button>
        <div id="databaseResult" class="result" style="display:none;"></div>
    </div>

    <div class="debug-section">
        <h3>4. Console Logs</h3>
        <div id="consoleOutput" style="height: 200px; overflow-y: auto; background: #000; color: #0f0; padding: 10px; font-family: monospace; font-size: 12px;"></div>
        <button class="test-button" onclick="clearConsole()">Clear Console</button>
    </div>

    <script>
        const originalLog = console.log;
        const originalError = console.error;
        const consoleDiv = document.getElementById('consoleOutput');

        function logToDiv(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#f66' : '#0f0';
            consoleDiv.innerHTML += `<div style="color: ${color};">[${timestamp}] ${message}</div>`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            logToDiv(args.join(' '));
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            logToDiv(args.join(' '), 'error');
        };

        function clearConsole() {
            consoleDiv.innerHTML = '';
        }

        async function testNetlifyFunction() {
            const benchId = document.getElementById('benchId').value;
            const resultDiv = document.getElementById('netlifyResult');
            
            if (!benchId) {
                resultDiv.innerHTML = '<div class="error">Bitte geben Sie eine Bench ID ein</div>';
                resultDiv.style.display = 'block';
                return;
            }

            console.log(`Testing Netlify function for bench_id: ${benchId}`);
            
            try {
                const url = `/.netlify/functions/get-approved-images-for-bench?bench_id=${benchId}`;
                console.log(`Calling: ${url}`);
                
                const response = await fetch(url);
                console.log(`Response status: ${response.status}`);
                console.log(`Response ok: ${response.ok}`);
                
                const data = await response.json();
                console.log('Response data (raw):', JSON.stringify(data, null, 2));

                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">‚úÖ Function call successful!</div>
                        <pre>Status: ${response.status}
URL: ${url}
Data: ${JSON.stringify(data, null, 2)}</pre>
                    `;
                    
                    if (Array.isArray(data) && data.length > 0) {
                        let imageTests = '<h4>Image URL Tests:</h4>';
                        data.forEach((img, index) => {
                            imageTests += `
                                <div class="image-test">
                                    <img src="${img.imageUrl}" 
                                         onload="this.nextElementSibling.innerHTML='‚úÖ L√§dt erfolgreich'" 
                                         onerror="this.nextElementSibling.innerHTML='‚ùå L√§dt nicht'; this.className='result-image error-border'"
                                         class="result-image">
                                    <div>Loading...</div>
                                    <div><strong>${img.description || 'Kein Titel'}</strong><br>
                                    <small>${img.imageUrl}</small></div>
                                </div>
                            `;
                        });
                        resultDiv.innerHTML += imageTests;
                    } else {
                        resultDiv.innerHTML += '<div>‚ÑπÔ∏è Keine zus√§tzlichen Bilder gefunden</div>';
                    }
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">‚ùå Function call failed!</div>
                        <pre>Status: ${response.status}
Error: ${JSON.stringify(data, null, 2)}</pre>
                    `;
                }
            } catch (error) {
                console.error('Network error:', error);
                resultDiv.innerHTML = `
                    <div class="error">‚ùå Network Error!</div>
                    <pre>${error.message}</pre>
                `;
            }
            
            resultDiv.style.display = 'block';
        }

        async function testImageLoading() {
            const resultDiv = document.getElementById('imageTestResult');
            
            // Test URLs - ersetzen Sie diese mit echten URLs aus Ihrer Datenbank
            const testImages = [
                {
                    type: 'Original Bench Image',
                    url: 'https://res.cloudinary.com/dp3t4ctxz/image/upload/v1234567890/bench_sample.jpg',
                    description: 'Original bench image from Cloudinary'
                },
                {
                    type: 'Additional Image',
                    url: 'https://res.cloudinary.com/dp3t4ctxz/image/upload/v1234567891/additional_sample.jpg',
                    description: 'Additional image from database'
                }
            ];

            let html = '<h4>Image Loading Test:</h4>';
            testImages.forEach((img, index) => {
                html += `
                    <div class="image-test">
                        <img src="${img.url}" 
                             onload="console.log('‚úÖ ${img.type} loaded successfully'); this.nextElementSibling.innerHTML='‚úÖ L√§dt erfolgreich'" 
                             onerror="console.error('‚ùå ${img.type} failed to load'); this.nextElementSibling.innerHTML='‚ùå L√§dt nicht'; this.className='result-image error-border'"
                             class="result-image">
                        <div>Loading...</div>
                        <div><strong>${img.type}</strong><br>
                        <small>${img.url}</small></div>
                    </div>
                `;
            });

            resultDiv.innerHTML = html;
        }

        async function checkDatabaseStatus() {
            const resultDiv = document.getElementById('databaseResult');
            
            console.log('Checking database status...');
            
            try {
                // Test basic bench data
                const benchesResponse = await fetch('/.netlify/functions/get_benches');
                const benchesData = await benchesResponse.json();
                console.log('Benches data (raw):', JSON.stringify(benchesData, null, 2));

                let html = `
                    <div class="success">‚úÖ Database connection working</div>
                    <h4>Available Benches:</h4>
                    <pre>${JSON.stringify(benchesData, null, 2)}</pre>
                `;

                if (benchesData.success && benchesData.benches && benchesData.benches.length > 0) {
                    html += '<h4>Testing additional images for each bench:</h4>';
                    
                    for (const bench of benchesData.benches) {
                        try {
                            const imagesResponse = await fetch(`/.netlify/functions/get-approved-images-for-bench?bench_id=${bench.id}`);
                            const imagesData = await imagesResponse.json();
                            
                            html += `
                                <div style="margin: 10px 0; padding: 10px; background: #f5f5f5;">
                                    <strong>Bench ID ${bench.id}: ${bench.name}</strong><br>
                                    Additional images: ${Array.isArray(imagesData) ? imagesData.length : 'Error loading'}
                                    <pre style="margin-top: 5px; font-size: 10px;">${JSON.stringify(imagesData, null, 2)}</pre>
                                </div>
                            `;
                        } catch (error) {
                            html += `<div class="error">Error loading images for bench ${bench.id}: ${error.message}</div>`;
                        }
                    }
                }

                resultDiv.innerHTML = html;
                
            } catch (error) {
                console.error('Database check failed:', error);
                resultDiv.innerHTML = `
                    <div class="error">‚ùå Database check failed!</div>
                    <pre>${error.message}</pre>
                `;
            }
            
            resultDiv.style.display = 'block';
        }

        // Auto-run basic test on page load
        window.addEventListener('load', () => {
            console.log('üîß Bench Images Debug Tool loaded');
            console.log('Available functions:');
            console.log('- testNetlifyFunction(): Tests the get-approved-images-for-bench function');
            console.log('- testImageLoading(): Tests image URL loading');
            console.log('- checkDatabaseStatus(): Checks database connection and data');
        });
    </script>
</body>
</html>
