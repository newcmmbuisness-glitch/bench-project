<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Admin Panel - Bench Map</title>
    <style>
        body { margin:0; font-family: Arial, sans-serif; background: #f5f5f5; }
        .header { background: #2196F3; color: white; padding: 20px; text-align: center; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .stats { display: flex; gap: 20px; margin-bottom: 30px; }
        .stat-card { 
            background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            flex: 1; text-align: center;
        }
        .stat-number { font-size: 2em; font-weight: bold; color: #4caf50; }
        .stat-label { color: #666; margin-top: 5px; }
        .bench-card { 
            background: white; border-radius: 10px; padding: 20px; margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); border-left: 5px solid #ff9800;
        }
        .bench-card.approved { border-left-color: #4caf50; }
        .bench-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .bench-title { font-size: 1.2em; font-weight: bold; color: #333; }
        .bench-status { padding: 5px 15px; border-radius: 20px; font-size: 0.9em; }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-approved { background: #d4edda; color: #155724; }
        .bench-info { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        .bench-images { display: flex; gap: 15px; margin: 15px 0; }
        .bench-images img { 
            width: 150px; height: 100px; object-fit: cover; border-radius: 8px;
            border: 2px solid #ddd;
        }
        .actions { display: flex; gap: 10px; }
        .btn { 
            padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;
            font-size: 14px; text-decoration: none; display: inline-block;
        }
        .btn-approve { background: #4caf50; color: white; }
        .btn-reject { background: #f44336; color: white; }
        .btn-back { background: #666; color: white; }
        .btn:hover { opacity: 0.8; }
        .no-benches { text-align: center; padding: 50px; color: #666; }
        .filter-tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab { 
            padding: 10px 20px; background: white; border: 1px solid #ddd; 
            border-radius: 5px; cursor: pointer;
        }
        .tab.active { background: #4caf50; color: white; border-color: #4caf50; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üõ†Ô∏è Admin Panel - Bench Map</h1>
    </div>
    
    <div class="container">
        <div class="actions" style="margin-bottom: 20px;">
            <a href="bench_map.html" class="btn btn-back">‚Üê Zur√ºck zur Karte</a>
            <button onclick="refreshData()" class="btn" style="background: #2196F3; color: white;">üîÑ Aktualisieren</button>
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="pendingCount">0</div>
                <div class="stat-label">Wartende B√§nke</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="approvedCount">0</div>
                <div class="stat-label">Genehmigte B√§nke</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalUsers">0</div>
                <div class="stat-label">Registrierte Nutzer</div>
            </div>
        </div>
        
        <div class="filter-tabs">
            <div class="tab active" onclick="showTab('pending')">‚è≥ Wartende B√§nke</div>
            <div class="tab" onclick="showTab('approved')">‚úÖ Genehmigte B√§nke</div>
            <div class="tab" onclick="showTab('all')">üìã Alle B√§nke</div>
        </div>
        
        <div id="benchesList"></div>
    </div>

    <script>
        let pendingBenches = [];
        let approvedBenches = [];
        let users = [];
        let currentFilter = 'pending';
        
        function loadData() {
            pendingBenches = JSON.parse(localStorage.getItem('pendingBenches') || '[]');
            approvedBenches = JSON.parse(localStorage.getItem('approvedBenches') || '[]');
            users = JSON.parse(localStorage.getItem('benchUsers') || '[]');
            
            updateStats();
            displayBenches();
        }
        
        function updateStats() {
            document.getElementById('pendingCount').textContent = pendingBenches.length;
            document.getElementById('approvedCount').textContent = approvedBenches.length;
            document.getElementById('totalUsers').textContent = users.length;
        }
        
        function showTab(filter) {
            currentFilter = filter;
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            displayBenches();
        }
        
        function displayBenches() {
            const container = document.getElementById('benchesList');
            let benchesToShow = [];
            
            switch(currentFilter) {
                case 'pending':
                    benchesToShow = pendingBenches.map(b => ({...b, approved: false}));
                    break;
                case 'approved':
                    benchesToShow = approvedBenches.map(b => ({...b, approved: true}));
                    break;
                case 'all':
                    benchesToShow = [
                        ...pendingBenches.map(b => ({...b, approved: false})),
                        ...approvedBenches.map(b => ({...b, approved: true}))
                    ].sort((a, b) => new Date(b.created) - new Date(a.created));
                    break;
            }
            
            if (benchesToShow.length === 0) {
                container.innerHTML = `
                    <div class="no-benches">
                        <h3>Keine B√§nke ${currentFilter === 'pending' ? 'wartend' : currentFilter === 'approved' ? 'genehmigt' : 'vorhanden'}</h3>
                        <p>Es gibt derzeit keine B√§nke in dieser Kategorie.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = benchesToShow.map(bench => `
                <div class="bench-card ${bench.approved ? 'approved' : ''}">
                    <div class="bench-header">
                        <div class="bench-title">${escapeHtml(bench.name)}</div>
                        <div class="bench-status ${bench.approved ? 'status-approved' : 'status-pending'}">
                            ${bench.approved ? '‚úÖ Genehmigt' : '‚è≥ Wartend'}
                        </div>
                    </div>
                    
                    <div class="bench-info">
                        <div>
                            <strong>Beschreibung:</strong><br>
                            ${escapeHtml(bench.description)}
                        </div>
                        <div>
                            <strong>Position:</strong> ${bench.lat}, ${bench.lng}<br>
                            <strong>Eingereicht von:</strong> ${escapeHtml(bench.user)}<br>
                            <strong>Datum:</strong> ${new Date(bench.created).toLocaleString('de-DE')}
                        </div>
                    </div>
                    
                    <div class="bench-images">
                        <img src="${bench.benchImage}" alt="Bank" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTUwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2Y1ZjVmNSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTIiIGZpbGw9IiM5OTkiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5CYW5rPC90ZXh0Pjwvc3ZnPg=='">
                        <img src="${bench.viewImage}" alt="Aussicht" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTUwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2Y1ZjVmNSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTIiIGZpbGw9IiM5OTkiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5Bc3NzaWNodDwvdGV4dD48L3N2Zz4='">
                    </div>
                    
                    ${!bench.approved ? `
                        <div class="actions">
                            <button class="btn btn-approve" onclick="approveBench(${bench.id})">
                                ‚úÖ Genehmigen
                            </button>
                            <button class="btn btn-reject" onclick="rejectBench(${bench.id})">
                                ‚ùå Ablehnen
                            </button>
                        </div>
                    ` : `
                        <div class="actions">
                            <button class="btn btn-reject" onclick="removeBench(${bench.id})">
                                üóëÔ∏è Entfernen
                            </button>
                        </div>
                    `}
                </div>
            `).join('');
        }
        
        function approveBench(benchId) {
            const benchIndex = pendingBenches.findIndex(b => b.id === benchId);
            if (benchIndex === -1) return;
            
            const bench = pendingBenches[benchIndex];
            approvedBenches.push(bench);
            pendingBenches.splice(benchIndex, 1);
            
            localStorage.setItem('pendingBenches', JSON.stringify(pendingBenches));
            localStorage.setItem('approvedBenches', JSON.stringify(approvedBenches));
            
            showNotification('Bank wurde genehmigt und ist jetzt auf der Karte sichtbar!', 'success');
            loadData();
        }
        
        function rejectBench(benchId) {
            if (!confirm('Bank wirklich ablehnen und l√∂schen?')) return;
            
            const benchIndex = pendingBenches.findIndex(b => b.id === benchId);
            if (benchIndex === -1) return;
            
            pendingBenches.splice(benchIndex, 1);
            localStorage.setItem('pendingBenches', JSON.stringify(pendingBenches));
            
            showNotification('Bank wurde abgelehnt und entfernt.', 'success');
            loadData();
        }
        
        function removeBench(benchId) {
            if (!confirm('Genehmigte Bank wirklich entfernen?')) return;
            
            const benchIndex = approvedBenches.findIndex(b => b.id === benchId);
            if (benchIndex === -1) return;
            
            approvedBenches.splice(benchIndex, 1);
            localStorage.setItem('approvedBenches', JSON.stringify(approvedBenches));
            
            showNotification('Bank wurde entfernt.', 'success');
            loadData();
        }
        
        function refreshData() {
            loadData();
            showNotification('Daten wurden aktualisiert.', 'success');
        }
        
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed; top: 20px; right: 20px; z-index: 1000;
                padding: 15px 20px; border-radius: 5px; color: white;
                background: ${type === 'success' ? '#4caf50' : '#f44336'};
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.remove(), 4000);
        }
        
        function escapeHtml(text) {
            return String(text).replace(/[&<>"']/g, m => ({
                '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
            }[m]));
        }
        
        // Check admin access
        const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
        if (!currentUser || !currentUser.isAdmin) {
            alert('Zugriff verweigert! Nur f√ºr Administratoren.');
            window.location.href = 'bench_map.html';
        } else {
            loadData();
        }
    </script>
</body>
</html>